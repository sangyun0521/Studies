# LAN
한정된 공간에서 네트워크를 구성하는 것을 Local Area Network (LAN)이라고 부른다 
* LAN은 보통 IP대역과 Subnet Mask를 가진다
* 동일한 IP 대역과 Subnet Mask를 가진다면 동일한 LAN이다

# Ethernet
LAN을 구축하면 그 내부적으로 통신 프로토콜이 필요하다. 
LAN에서 가장 많이 사용되어 왔으며 또 거의 표준으로 사용하고 있는 기술이 이더넷이다. 

이더넷은 CSMA/CD (Carrier Sense Multiple Access / Collision Detection)라는 방식을 사용하여 통신을 수행한다. 

# CS (Carrier Sense)
CS는 네트워크 상에서 통신이 일어나고 있는지 확인하는 작업을 의미한다. 

사실 요즘 네트워크를 구성하면 스위치라는 장비를 사용하여 각 포트 마다 서버를 연결하기 때문에 사실 각 서버가 충돌을 고려하지 않아도 된다. 
하지만 이더넷이 처음 나온 시절에는 Bus Topology 형태의 네트워크를 많이 사용했다.
![[Pasted image 20250305124225.png]]

이런 구조는 하나의 공유 회선을 네트워크 내부의 모든 서버가 공유하는 구조이기 때문에 각 서버가 동시에 데이터를 전송하려고 하면 충돌이 발생할 수 있다. 

그렇기 때문에 각 서버는 데이터를 전송하기 전에 CS를 통해 현재 공유 회선을 다른 서버가 사용중인지 확인하게 된다.

이 때, 공유 회선을 다른 서버가 사용 중이라면 조금 기다렸다가 다시 CS를 시도하게 된다. 

# MA (Multiple Access)
MA는 네트워크 상에서 각 서버는 CS를 하고 보내지만 여전히 충돌이 발생할 수 있음을 의미한다. 

두 서버가 서로 같은 시점에 데이터를 전송하려고 CS를 하게 되면 두 서버 모두 공유 회선이 비어있다고 생각하고 데이터 전송을 시작하게 된다. 
이렇게 되면 결국 두 서버에서 전송한 데이터 충돌이 발생한다. 

이런 타이밍 이슈에 의해 CS를 하더라고 여전히 충돌이 발생할 수 있다.

# CD (Collision Detection)
CD는 네트워크 상에서 충돌을 대비하여 각 서버가 데이터를 전송한 뒤 일정 시간 동안 충돌을 감지하는 작업이다. 

데이터를 전송한뒤 각 서버는 자신이 보낸 데이터가 잘 전송 되었는지 확인을 위해 CD를 진행한다.

> [!송수신 노드가 어떻게 충돌을 감지할 수 있지?]
> CD는 전압을 감지한다
> nic는 자신이 보낸 데이터의 전압 최대치를 알고 있고 충돌이 발생하는 경우 공유 회선에 흐르는 전압이 이보다 높아지기 때문에 충돌을 감지할 수 있다고 한다
> 충돌이 발생하면 송신 노드는 Jamming 신호를 발생시켜 수신 노드도 수신 받은 데이터가 충돌이 난 데이터임을 알 수 있다. 

충돌을 감지하면 각 서버는 임의의 시간 동안 대기했다가 충돌이 발생하지 않을 때 까지 다시 시도한다. (최대 15회)
> [!임의의 시간?]
> 충돌이 발생했을 때 "임의의 시간동안 대기"하는 방식을 CSMA/CD에서 백오프 방식이라 한다.
> 충돌이 발생하고 두 서버가 동일한 시간 동안 대기한다면 재충돌이 발생할 가능성이 높다.
> 따라서 기본적으로 랜덤한 시간동안 기다리며 충돌이 발생한 횟수 만큼 확률적으로 더 많이 기다리도록 하는 방식을 사용한다.


# Token Ring
Token Ring은 LAN에서 이더넷의 대항마로 잠깐 등장했던 프로토콜인데 사실상 이더넷이 표준으로 사용되며 사라지게 된 프로토콜이다. 

기본적인 동작 방식은
* 토큰을 가진 서버만 데이터 전송 가능
* 데이터 전송한 뒤 다음 서버로 토큰을 전달

즉, 충돌 발생 자체를 방지하는 방식이다. 
충돌은 발생하지 않지만 데이터를 차례대로 보내야하기 때문에 데이터를 많이 보내야하는 서버 입장에서 비효율적이라고 할 수 있다.

# 네트워크 케이블
네트워크 케이블에는 광케이블, UTP 케이블, STP 케이블 등 다양한 종류가 있다.
* UTP : Unshielded Twisted Pair의 약자로 총 8개의 선이 2가닥씩 꼬여 있는 구조이다.
* STP : Shielded Twisted Pair의 약자로 절연체로 구리선이 감싸져 있다 

일반적으로 UTP 케이블을 많이 사용한다.
네트워크 케이블은 성능과 대역폭에 따라서 카테고리로도 구분된다. 

| Cat | 특징                |
| :-: | :---------------- |
|  1  | 전화망에 사용           |
|  2  | 4Mbps             |
|  3  | 10 Base T, 10Mbps |
|  4  | 토큰링에 사용           |
|  5  | 100 Base TX       |
|  6  | 10 Gbps           |
|  7  | 10 Gbps 이상        |
| ... |                   |

10 Base T, 100 Base T 등은 이더넷 규격을 의미한다. 
* 10은 10Mbps의 통신 속도를 의미
* Base는 baseband 전송 방식을 의미
* T는 twisted pair 케이블을 의미

> [!케이블]
> 케이블은 아래 그림과 같이 8개의 선으로 이루어지며 송신, 수신용 선으로 나뉘어 진다. 
> 이 때 2가지 종류의 케이블이 있다. (다이렉트 케이블, 크로스오버 케이블)
> * 다이렉트 케이블 : 다른 계층에 있는 장비간 연결을 위한 장비
> * 크로스오버 케이블 : 같은 계층에 있는 장비간 연결을 위한 장비
> 
>이렇게 2가지로 구분되는 이유는 송/수신을 담당하는 선이 따로 있다보니 각 장비의 송수신 핀 결합부와 맞게 연결을 해주어야 하기 때문이다. 그래서 어느 장비와 어느 장비를 연결 해야하는가에 따라서 적절한 케이블을 구매하는 것이 좋다. 하지만 요즘에는 랜카드가 Auto MDI/MDI-X를 통해 적절하게 송/수신 핀을 매핑하기 때문에 큰 문제는 없다고 한다.

**![](https://lh7-rt.googleusercontent.com/slidesz/AGV_vUcPfaci45zcIy3CtC1yMNSK05MCU7n1ZdTYUf_USfx3IMjeT2anfjHZKStoH6AwXrRuDPsDJQ7p3gAuA0JiDT6UOJLNFannxY3CxChmHhFiqApoq6xuLw2bBK4UOqOWtjsN5H529w-alKk-f4o6a4Y=s2048?key=u7cTXA2yyn5Y3YOmEZhOQ68_)**

# Media Access Control (MAC)
네트워크 내부에서는 각 장비를 구분할 ID 값이 필요하며 이를 MAC 주소라고 한다. 

이데넷은 MAC 주소를 통해서 서로 통신한다. 때문에 이더넷을 사용하고 싶은 사용자는 결국 상대방의 MAC 주소를 알아야 데이터를 전송할 수 있다. 

그런데 우리는 보통 IP를 통해서 데이터를 전송한다. 그러면 MAC주소를 어떻게 알아낼까?

# Address Resolution Protocol (ARP)
ARP는 IP 주소로 MAC 주소를 알아내는 프로토콜이다. 

운영체제는 내부적으로 arp 테이블을 유지하고 있다. arp 테이블은 IP-MAC 매핑 테이블이다. 
ARP 프로토콜
* ARP request : 특정 IP에 대한 MAC 주소를 모르는 경우 브로드캐스트로 IP에 대한 주인이 누구인지 물어보는 메시지
* ARP reply : ARP reques에 대한 응답으로 자신의 MAC 주소를 포함해서 요청을 보낸 서버에게 전달하는 메시지 
* Gratuitous ARP : 자신이 특정 IP를 가지고 있음을 브로드캐스트로 모두에게 알리는 메시지

> [!vip failover]
> 고가용성을 보장해야하는 환경에서는 ARP를 활용해서 VIP failover 기능을 제공한다. 
> VIP란 하나의 IP를 하나의 서버에서 고정하여 사용하지 않고 여러 서버에서 사용 가능하도록 설정하겠다는 의미이다. 
> 고가용성 환경에서 하나의 서버가 죽게되면 이를 감지하여 해당 서버가 가지고 있던 VIP를 다른 서버가 자신의 nic에 띄우고 Gratuitous ARP를 통해 네트워크의 클라이언트들에게 자신의 MAC 주소를 알린다. 
> 이렇게 되면 클라이언트 입장에서는 서버가 죽어도 동일한 VIP로 시스템에 문제가 발생하지 않은 것 처럼 사용할 수 있다.